# Device Tracker (Legal, Consent-Based)

This is a Python Flask web application that provides a blue-themed GUI to manage a registry of mobile devices (by IMEI or phone number), display coarse carrier/region info for phone numbers, and show last known location when the device posts updates to the server.

Important: Real-time tracking of a mobile device by IMEI or phone number without the ownerâ€™s informed consent or carrier/law-enforcement involvement is not legally permitted in most jurisdictions. This app is designed for legitimate, consent-based scenarios such as enterprise MDM or personal devices you own.

## Features
- Dark and light blue theme with a simple dashboard UI.
- Search by IMEI (validated via Luhn) or phone number (validated and normalized to E.164 using `phonenumbers`).
- Coarse region and carrier display for phone numbers via offline `phonenumbers` data.
- Device registry stored in SQLite at `data/app.db`.
- Companion `/api/location_update` endpoint to accept location updates from a user-consented agent/app.
- Leaflet map rendering for last known location.
- Authentication with roles (`admin`, `viewer`) and login/logout.
- SMS-based onboarding via Vonage to send agent install link.
- Location history stored and rendered as a timeline and map path.
- Export/import tools for merging device inventories.
 - Token-based authentication for `/api/location_update` bound to each device.
 - Admin is auto-seeded (first account) on first run.

## Limitations and Legal Notes
- Carrier-based triangulation or locating SIMs without internet access requires carrier cooperation and is not available to consumer apps.
- Without connectivity from the device (internet/SMS agent), this dashboard can only show the last known location and coarse phone-region info.
- Use this software lawfully, with consent, and in compliance with local regulations.

## Running Locally
1. Create a virtual environment (optional) and install dependencies:
   ```bash
   python -m pip install flask phonenumbers vonage
   ```
2. Start the server:
   ```bash
   python app.py
   ```
3. Open the app in your browser at `http://localhost:5000/`.

### Environment Variables
- `SECRET_KEY`: Flask secret key.
- `AGENT_DOWNLOAD_URL`: URL your companion agent can be downloaded from.
- `VONAGE_API_KEY`, `VONAGE_API_SECRET`, `VONAGE_FROM_NUMBER`: for SMS onboarding and 2FA.

Default admin user: `admin` / `admin`. You can override via environment variables `ADMIN_USERNAME` and `ADMIN_PASSWORD`. Change or create your own under Create User.

## Registering a Device
- Use the **Add Device** button to register an IMEI and/or a phone number.
- Once registered, a consented companion app can POST location updates to:
  - `POST /api/location_update`
  - JSON body: `{ "imei": "...", "phone": "+15551234567", "lat": 37.7749, "lng": -122.4194, "token": "DEVICE_TOKEN" }`
  - The device token can be viewed/regenerated by an admin under `Device Token` in the navbar.
  - Location history, last update time, and tokens are stored in SQLite.

## Export / Import
- Export: GET `/export` returns current devices and locations as JSON.
- Import: POST `/import` with a JSON file to merge devices into the DB (unique by IMEI/phone). Existing devices are not duplicated.

## Packaging (Desktop)
- You can package the app into a desktop executable using tools like PyInstaller:
  ```bash
  python -m pip install pyinstaller
  pyinstaller --onefile app.py
  ```
- Alternatively, wrap the Flask app with a desktop shell (e.g., Eel) if you prefer a downloadable GUI that serves the web UI.

## Notes on IMEI and Phone Number Data
- IMEI format validation uses the Luhn checksum to reduce errors.
- Phone numbers are normalized to E.164 and validated via `phonenumbers`. Region and carrier info is coarse and may vary.
## Android Agent Example
See `agent_examples/android/README.md` for a scaffold and code snippet demonstrating user-consented location posting to `/api/location_update`.